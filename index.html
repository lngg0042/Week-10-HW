<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Transportation and Logistic in Malaysia</title>
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      margin: 18px;
      background: #fafafa;
      color: #111;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #vis {
      max-width: 1000px;
      width: 100%;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      border-radius: 6px;
      overflow: hidden;
      background: white;
      padding: 8px;
    }
  </style>
  <!-- Vega scripts -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>
  <h1>Transportation and Logistic in Malaysia</h1>
  <div id="vis"></div>

  <script>
    const spec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "vconcat": [
        {
          "width": 800,
          "height": 450,
          "title": {"text": "Airports in Malaysia", "fontSize": 20, "font": "Arial"},
          "projection": {"type": "equalEarth","center": [110, 4],"scale": 2500,"translate": [420, 225]},
          "layer": [
            {
              "mark": {"type": "rect","fill": null,"stroke": "black","strokeWidth": 2},
              "encoding": {"x": {"value": 0},"y": {"value": 0},"x2": {"value": 800},"y2": {"value": 450}}
            },
            {
              "data": {"graticule": {"step": [10, 10]}},
              "mark": {"type": "geoshape","stroke": "lightgray","strokeWidth": 1}
            },
            {
              "data": {
                "url": "https://raw.githubusercontent.com/lngg0042/Week-10-HW/refs/heads/main/my_state.json",
                "format": {"type": "topojson","feature": "my"}
              },
              "mark": {"type": "geoshape","fill": "lightgray","stroke": "white"}
            },
            {
              "data": {"url": "https://raw.githubusercontent.com/lngg0042/Week-10-HW/refs/heads/main/my-airports.csv"},
              "transform": [
                {"filter": "datum.name != 'name'"},
                {"filter": "datum.type != '#loc +airport +type'"},
                {
                  "calculate": "datum.type == 'large_airport' ? 'Large Airport' : datum.type == 'medium_airport' ? 'Medium Airport' : datum.type == 'small_airport' ? 'Small Airport' : datum.type == 'heliport' ? 'Heliport' : datum.type == 'closed' ? 'Closed' : datum.type",
                  "as": "type_label"
                }
              ],
              "mark": "circle",
              "params": [
                {"name": "airportType","select": {"type": "point","fields": ["type_label"]},"bind": "legend"}
              ],
              "encoding": {
                "longitude": {"field": "longitude_deg","type": "quantitative"},
                "latitude": {"field": "latitude_deg","type": "quantitative"},
                "size": {"value": 50},
                "color": {
                  "field": "type_label","type": "nominal","title": "Airport Type",
                  "legend": {"titleFontSize": 15,"labelFontSize": 12,"symbolSize": 100,"symbolStrokeWidth": 4}
                },
                "opacity": {"condition": {"param": "airportType","value": 1},"value": 0.2},
                "tooltip": [
                  {"field": "name","title": "Airport"},
                  {"field": "municipality","title": "City"},
                  {"field": "region_name","title": "State"},
                  {"field": "type_label","title": "Type"}
                ]
              }
            },
            {
              "data": {
                "values": [
                  {"state": "Johor","lon": 103.5,"lat": 1.8},
                  {"state": "Penang","lon": 100.3,"lat": 5.4},
                  {"state": "Sabah","lon": 116.5,"lat": 5.5},
                  {"state": "Sarawak","lon": 113.0,"lat": 2.0}
                ]
              },
              "mark": {"type": "text","fontSize": 12,"fontWeight": "bold","color": "black","dy": -5},
              "encoding": {"longitude": {"field": "lon"},"latitude": {"field": "lat"},"text": {"field": "state"}}
            },
            {
              "data": {"url": "https://raw.githubusercontent.com/lngg0042/Week-9-HW/main/my-airports.csv"},
              "transform": [{"filter": "datum.type == 'large_airport'"}],
              "mark": {"type": "text","dy": -8,"fontSize": 10,"fontWeight": "bold","color": "black"},
              "encoding": {"longitude": {"field": "longitude_deg"},"latitude": {"field": "latitude_deg"},"text": {"field": "name"}}
            }
          ]
        },
        {
          "width": 800,
          "height": 450,
          "title": {"text": "Yearly Employment Trend (Total Persons Engaged)", "fontSize": 20, "font": "Arial", "anchor": "middle"},
          "data": {
            "url": "https://raw.githubusercontent.com/lngg0042/Week-10-HW/refs/heads/main/Principal%20Statistics%20of%20Transportation%20and%20Storage%20Services%20by%20State%20dataset.csv"
          },
          "transform": [
            {"aggregate": [{"op": "sum","field": "Total number of persons engaged ","as": "Total Persons Engaged"}],"groupby": ["Year"]},
            {"window": [{"op": "first_value","field": "Total Persons Engaged","as": "BaseEmployment"}],"frame": [null,null],"sort": [{"field": "Year","order": "ascending"}]},
            {"calculate": "(datum['Total Persons Engaged'] / datum['BaseEmployment']) * 100","as": "Employment Index"}
          ],
          "layer": [
            {
              "mark": {"type": "line","strokeWidth": 3,"color": "#1f77b4"},
              "encoding": {
                "x": {"field": "Year","type": "ordinal","title": "Year","sort": "ascending","axis": {"labelAngle": 0}},
                "y": {"field": "Employment Index","type": "quantitative","title": "Employment Index (Base Year = 100)","scale": {"zero": false}}
              }
            },
            {
              "mark": {"type": "point","filled": true,"color": "#d62728","size": 80},
              "encoding": {
                "x": {"field": "Year","type": "ordinal","sort": "ascending"},
                "y": {"field": "Employment Index","type": "quantitative"},
                "tooltip": [
                  {"field": "Year","type": "ordinal"},
                  {"field": "Total Persons Engaged","type": "quantitative","format": ","},
                  {"field": "Employment Index","type": "quantitative","format": ".1f"}
                ]
              }
            },
            {
              "mark": {"type": "text","dy": -10,"fontSize": 12,"color": "black"},
              "encoding": {
                "x": {"field": "Year","type": "ordinal","sort": "ascending"},
                "y": {"field": "Employment Index","type": "quantitative"},
                "text": {"field": "Employment Index","type": "quantitative","format": ".0f"}
              }
            }
          ]
        }
      ]
    };

    vegaEmbed('#vis', spec, {renderer: "canvas", actions: {export: true, source: true, compiled: false, editor: false}});
  </script>
</body>
</html>
